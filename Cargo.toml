[package]
name = "motedb"
version = "0.1.0"
edition = "2021"
description = "AI-native embedded multimodal database for embodied intelligence (robots, AR glasses, industrial arms)."
license = "MIT"
repository = "https://github.com/motedb/motedb"
homepage = "https://github.com/motedb/motedb"
documentation = "https://docs.rs/motedb"
readme = "docs/README.md"
keywords = ["database", "embedded", "vector", "multimodal", "ai", "edge"]
categories = ["database", "embedded", "algorithms"]
authors = ["motedb <motedb@126.com>"]
publish = true

[lib]
name = "motedb"
path = "src/lib.rs"
crate-type = ["rlib", "staticlib", "cdylib"]  # rlib = Ruståº“(å…è®¸examples), staticlib = é™æ€åº“, cdylib = åŠ¨æ€åº“

[[bin]]
name = "motedb-cli"
path = "src/bin/motedb-cli.rs"

[dependencies]
# Memory-mapped file I/O (used by: spatial_hybrid, diskann/sst)
memmap2 = "0.9"

# Compression (used by: LSM engine, sstable, memtable, txn)
snap = "1.1"  # Snappy compression (fast, moderate ratio)

# CRC32 for data integrity (used by: manifest, checksum, WAL)
crc32fast = "1.4"

# High-performance locks (used throughout: indexes, storage, transactions)
parking_lot = "0.12"

# Lock-free data structures (future use: planned for concurrent operations)
crossbeam = "0.8"

# LRU cache (used by: btree, spatial, text_dictionary, cached_index, row_cache)
lru = "0.12"

# Roaring Bitmap for text index posting lists (used by: text_types)
roaring = "0.10"

# Fast hash algorithm (used throughout: HashMaps, Sets)
ahash = "0.8"

# Serialization (used by: all indexes, storage, catalog, txn, SQL)
serde = { version = "1.0", features = ["derive"] }
bincode = "1.3"  # Binary serialization for indexes and storage
serde_json = "1.0"  # JSON for manifest and metadata

# Error handling (used throughout)
thiserror = "1.0"
anyhow = "1.0"

# System calls for durability (used by: btree, diskann, manifest, WAL)
libc = "0.2"

# Random number generation (used by: tests, evaluator RANDOM(), benchmarks)
rand = "0.8"

# Data parallelism (used throughout: batch operations, indexing)
rayon = "1.8"
dashmap = "6.1.0"  # Concurrent HashMap

# ğŸ”Œ Optional dependencies: Tokenizer plugins (feature-gated)
jieba-rs = { version = "0.7", optional = true }

# ğŸ” Optional: Memory profiling (feature-gated)
tikv-jemallocator = { version = "0.5", optional = true }
tikv-jemalloc-ctl = { version = "0.5", optional = true }

[dev-dependencies]
# Benchmarking
criterion = { version = "0.5", features = ["html_reports"] }

# Temporary directories for testing
tempfile = "3.0"

# Memory profiling with jemalloc
tikv-jemallocator = "0.5"
tikv-jemalloc-ctl = "0.5"

# Command line argument parsing (for examples)
clap = { version = "4.4", features = ["derive"] }

[features]
default = []  # ğŸ¯ é»˜è®¤é…ç½®,å‡å°äºŒè¿›åˆ¶å¤§å°
# ğŸ”Œ å¯é€‰åˆ†è¯å™¨æ’ä»¶
tokenizer-jieba = ["jieba-rs"]  # ä¸­æ–‡åˆ†è¯ï¼ˆJiebaï¼‰
tokenizer-all = ["tokenizer-jieba"]  # å¯ç”¨æ‰€æœ‰åˆ†è¯å™¨
# ğŸ” å†…å­˜åˆ†æï¼ˆç”¨äºæ€§èƒ½è°ƒä¼˜ï¼‰
mem-profiling = ["tikv-jemallocator", "tikv-jemalloc-ctl"]

[profile.release]
opt-level = 3  # ğŸš€ ä¼˜åŒ–æ€§èƒ½ï¼ˆ3 = æœ€å¿«ï¼Œz = æœ€å°ï¼‰
lto = "fat"    # ğŸ”¥ Fat LTOï¼šæœ€æ¿€è¿›çš„ä¼˜åŒ–ï¼ˆ+20% æ€§èƒ½ï¼‰
codegen-units = 1  # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒï¼ˆæ›´å¥½çš„ä¼˜åŒ–ï¼‰
strip = true   # ç§»é™¤ç¬¦å·è¡¨ï¼ˆ-30% å¤§å°ï¼‰
panic = "abort"  # panic ç›´æ¥ abortï¼ˆ-10% å¤§å°ï¼‰

[build]
# ğŸš€ SIMD ä¼˜åŒ–ï¼šå¯ç”¨ AVX2 æŒ‡ä»¤é›†ï¼ˆè·ç¦»è®¡ç®—åŠ é€Ÿ 3-4xï¼‰
rustflags = ["-C", "target-cpu=native"]

[profile.release-small]
# ğŸ†• åµŒå…¥å¼æ¨¡å¼ï¼šä¼˜åŒ–äºŒè¿›åˆ¶å¤§å°
inherits = "release"
opt-level = "z"  # ä¼˜åŒ–å¤§å°
lto = "fat"
